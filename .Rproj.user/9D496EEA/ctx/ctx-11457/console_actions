{
    "type": [
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        0,
        0,
        1,
        0,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        0,
        1,
        0,
        0,
        1,
        0,
        1,
        3,
        0,
        0,
        1,
        0,
        1,
        3,
        0,
        0,
        1,
        0,
        0,
        1,
        0,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        0,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        0,
        0,
        1,
        0,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        2,
        0,
        1,
        3,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        2,
        2,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        2
    ],
    "data": [
        "\nR version 4.5.0 (2025-04-11 ucrt) -- \"How About a Twenty-Six\"\nCopyright (C) 2025 The R Foundation for Statistical Computing\nPlatform: x86_64-w64-mingw32/x64\n\nR è un software libero ed è rilasciato SENZA ALCUNA GARANZIA.\nSiamo ben lieti se potrai redistribuirlo, ma sotto certe condizioni.\nScrivi 'license()' o 'licence()' per maggiori dettagli.\n\nR è un progetto collaborativo con molti contributi esterni.\nScrivi 'contributors()' per maggiori informazioni e 'citation()'\nper sapere come citare R o i pacchett",
        "i nelle pubblicazioni.\n\nScrivi 'demo()' per una dimostrazione, 'help()' per la guida\noppure 'help.start()' per la guida nel browser HTML.\nScrivi 'q()' per uscire da R.\n\n",
        "> ",
        "in_file <- \"//10.0.1.243/nr_data/3_rs_data/PRISMA/JDS/2023/L2C/prove_per_pacchetto/PRS_L2C_STD_20230304102047_20230304102051_0001.he5\"",
        "> ",
        "out_folder  <-  \"//10.0.1.243/nr_data/3_rs_data/PRISMA/JDS/2023/L2C/prove_per_pacchetto/\"",
        "> ",
        "s2_file <- \"//10.0.1.243/nr_data/3_rs_data/PRISMA/JDS/2023/L2C/prove_per_pacchetto/S2_20230309_B08_T32TQQ_ritagliato_QGIS.tif\"",
        "> ",
        "#in_file <- \"//10.0.1.243/nr_data/3_rs_data/PRISMA/JDS/2025/L1/prove_per_pacchetto/PRS_L1_STD_OFFL_20250424100426_20250424100430_0001.he5\"",
        "> ",
        "#out_folder <- \"//10.0.1.243/nr_data/3_rs_data/PRISMA/JDS/2025/L1/prove_per_pacchetto/\"",
        "> ",
        "#s2_file <- \"//10.0.1.243/nr_data/3_rs_data/PRISMA/JDS/2025/L1/prove_per_pacchetto/S2_20250422T101051_B08_T32TQQ_ritagliato_coordinate.tif\"",
        "> ",
        "> ",
        "######################################################################",
        "> ",
        "#deduce folders ----",
        "> ",
        "######################################################################",
        "> ",
        "product_type <- substring(basename(in_file),5,6)",
        "> ",
        "coreg_out_folder <- paste0(out_folder,\"coreg/\")",
        "> ",
        "smoothing_out_folder <- paste0(out_folder,\"smoothing/\")",
        "> ",
        "library(tidytable)",
        "\u001BG3;\nCaricamento pacchetto: ‘tidytable’\n\n\u001Bg\u001BG3;I seguenti oggetti sono mascherati da ‘package:stats’:\n\n    dt, filter, lag\n\n\u001Bg\u001BG3;Il seguente oggetto è mascherato da ‘package:base’:\n\n    %in%\n\n\u001Bg",
        "> ",
        "> ",
        "base::dir.create(smoothing_out_folder, recursive = T, showWarnings = F)",
        "> ",
        "> ",
        "if(product_type == \"L1\"){",
        "+ ",
        "  input_image_path <- paste0(coreg_out_folder,\"prs_cld_crs_translate_warp.tif\")",
        "+ ",
        "}",
        "> ",
        "if(product_type == \"L2\"){",
        "+ ",
        "  input_image_path <- paste0(coreg_out_folder,\"prs_crs_translate_warp.tif\")",
        "+ ",
        "}",
        "> ",
        "> ",
        "output_path <-  paste0(smoothing_out_folder, \"PRISMA_smoothed.tif\")",
        "> ",
        "> ",
        "PRISMA_config <- tidytable::fread(here::here(\"PRISMA_spectral_configuration.csv\")) %>%",
        "+ ",
        "  mutate(band_row = row_number()) ",
        "\u001BG2;\u001BH2;Messaggio di avvertimento\u001Bh:\nIn file.info(file) :\n  cannot resolve owner of file '\\\\10.0.1.243/nr_working/emanuele/Progetto_PRISMA/PRISMA_code/PRISMA_spectral_configuration.csv': Non è stato effettuato alcun mapping tra nomi di account e ID di sicurezza (SID)\n\u001Bg",
        "> ",
        "> ",
        "PRISMA_bad_bands_table <- tidytable::fread(here::here(\"PRISMA_band_selections.csv\")) %>%",
        "+ ",
        "  filter(BB_SUPER_V3 == 1)",
        "\u001BG2;\u001BH2;Messaggio di avvertimento\u001Bh:\nIn file.info(file) :\n  cannot resolve owner of file '\\\\10.0.1.243/nr_working/emanuele/Progetto_PRISMA/PRISMA_code/PRISMA_band_selections.csv': Non è stato effettuato alcun mapping tra nomi di account e ID di sicurezza (SID)\n\u001Bg",
        "> ",
        "> ",
        "input_bad_bands <- PRISMA_bad_bands_table$band",
        "> ",
        "> ",
        "input_wvl <- PRISMA_config$center",
        "> ",
        "> ",
        "output_wvl <- PRISMA_config %>%",
        "+ ",
        "  filter(BND_SEL  == 1) %>%",
        "+ ",
        "  pull(center)",
        "> ",
        "> ",
        "> ",
        "spline_fun <- function(pixel, band_center_input, bad_bands_pos, band_center_output, df = 40) {",
        "+ ",
        "  # togliamo le bande cattive",
        "+ ",
        "  ref_valid <- pixel[-bad_bands_pos]",
        "+ ",
        "  wvl_valid <- band_center_input[-bad_bands_pos]",
        "+ ",
        "  ",
        "+ ",
        "  if (any(is.na(ref_valid))) {",
        "+ ",
        "    return(rep(NA_real_, length(band_center_output)))",
        "+ ",
        "  }",
        "+ ",
        "  ",
        "+ ",
        "  sp <- stats::smooth.spline(x = wvl_valid, y = ref_valid, df = df)",
        "+ ",
        "  y_smooth <- predict(sp, x = band_center_output)$y",
        "+ ",
        "  # limitiamo a zero",
        "+ ",
        "  y_smooth[y_smooth < 0] <- 0",
        "+ ",
        "  return(y_smooth)",
        "+ ",
        "}",
        "> ",
        "> ",
        "> ",
        "terra_image <- terra::rast(input_image_path)",
        "> ",
        "> ",
        "if(product_type == \"L1\"){",
        "+ ",
        "  terra_image_sub <- terra::subset(terra_image,subset = 231,negate=T)",
        "+ ",
        "}",
        "> ",
        "if(product_type == \"L2\"){",
        "+ ",
        "  terra_image_sub <- terra_image",
        "+ ",
        "}",
        "> ",
        "> ",
        "output_image <- terra::app(",
        "+ ",
        "  x = terra_image_sub,",
        "+ ",
        "  fun = spline_fun,",
        "+ ",
        "  band_center_input = input_wvl, ",
        "+ ",
        "  bad_bands_pos = input_bad_bands, ",
        "+ ",
        "  band_center_output = output_wvl,",
        "+ ",
        "  df=40,",
        "+ ",
        "  ",
        "+ ",
        "  cores = 7,                     ",
        "+ ",
        "  filename = output_path,",
        "+ ",
        "  overwrite = TRUE,",
        "+ ",
        "  wopt = list(gdal = c(\"COMPRESS=LZW\", \"TILED=YES\"))",
        "+ ",
        ")",
        "\r|---------|---------|---------|---------|\r=========================================\r                                          \r",
        "> ",
        "??substring",
        "> ",
        "??usethis::edit_r_environ",
        "> ",
        "usethis::edit_r_environ()",
        "\u001BG3;\u001B[31m☐\u001B[39m Modify \u001B]8;;file://C:/Users/Emanuele/Documents/.Renviron\u0007\u001B[34mC:/Users/Emanuele/Documents/.Renviron\u001B[39m\u001B]8;;\u0007.\n\u001Bg\u001BG3;\u001B[31m☐\u001B[39m Restart R for changes to take effect.\n\u001Bg",
        "> ",
        "here()",
        "\u001BG1;Errore in here() : non trovo la funzione \"here\"\n\u001Bg",
        "> ",
        "here::here()",
        "[1] \"\\\\\\\\10.0.1.243/nr_working/emanuele/Progetto_PRISMA/PRISMA_code\"\n",
        "> ",
        "usethis::edit_r_environ(scope = \"project\")",
        "\u001BG3;\u001B[32m✔\u001B[39m Setting active project to \u001B[34m\"//10.0.1.243/nr_working/emanuele/Progetto_PRISMA/PRISMA_code\"\u001B[39m.\n\u001Bg\u001BG3;\u001B[31m☐\u001B[39m Modify \u001B]8;;file://\\\\10.0.1.243/nr_working/emanuele/Progetto_PRISMA/PRISMA_code/.Renviron\u0007\u001B[34m.Renviron\u001B[39m\u001B]8;;\u0007.\n\u001Bg\u001BG3;\u001B[31m☐\u001B[39m Restart R for changes to take effect.\n\u001Bg\u001BG2;\u001BH2;Messaggio di avvertimento\u001Bh:\nIn file.info(path) :\n  cannot resolve owner of file '\\\\10.0.1.243/nr_working/emanuele/Progetto_PRISMA/PRISMA_code/.Renviron': Non è stato effettuato alcun mapp",
        "ing tra nomi di account e ID di sicurezza (SID)\n\u001Bg",
        "> ",
        "??write",
        "> ",
        "?write",
        "> ",
        "here::here(\".Renviron\")",
        "[1] \"\\\\\\\\10.0.1.243/nr_working/emanuele/Progetto_PRISMA/PRISMA_code/.Renviron\"\n",
        "> ",
        "write('RETICULATE_PYTHON=\"C:/prova/Rconda/python.exe\"', here::here(\".Renviron\"))",
        "\u001BG1;Errore in file(file, ifelse(append, \"a\", \"w\")) : \n  non è possibile aprire la connessione\nIn aggiunta: Messaggio di avvertimento:\nIn file(file, ifelse(append, \"a\", \"w\")) :\n  non è possibile aprire il file '\\\\10.0.1.243/nr_working/emanuele/Progetto_PRISMA/PRISMA_code/.Renviron': Permission denied\n\u001Bg",
        "> ",
        "write(value, here::here(\".Renviron\"))",
        "\u001BG1;Errore in file(file, ifelse(append, \"a\", \"w\")) : \n  non è possibile aprire la connessione\nIn aggiunta: Messaggio di avvertimento:\nIn file(file, ifelse(append, \"a\", \"w\")) :\n  non è possibile aprire il file '\\\\10.0.1.243/nr_working/emanuele/Progetto_PRISMA/PRISMA_code/.Renviron': Permission denied\n\u001Bg",
        "> ",
        "write(value, here::here(\".Renviron\"))",
        "\u001BG1;Errore in file(file, ifelse(append, \"a\", \"w\")) : \n  non è possibile aprire la connessione\nIn aggiunta: Messaggio di avvertimento:\nIn file(file, ifelse(append, \"a\", \"w\")) :\n  non è possibile aprire il file '\\\\10.0.1.243/nr_working/emanuele/Progetto_PRISMA/PRISMA_code/.Renviron': Permission denied\n\u001Bg",
        "> ",
        "write(value, here::here(\"prova.txt\"))",
        "\u001BG1;Errore: oggetto 'value' non trovato\n\u001Bg",
        "> ",
        "value <-'RETICULATE_PYTHON=\"C:/prova/Rconda/python.exe\"' ",
        "> ",
        "write(value, here::here(\"prova.txt\"))",
        "> ",
        "write(value, here::here(\".Renviron\"))",
        "\u001BG1;Errore in file(file, ifelse(append, \"a\", \"w\")) : \n  non è possibile aprire la connessione\nIn aggiunta: Messaggio di avvertimento:\nIn file(file, ifelse(append, \"a\", \"w\")) :\n  non è possibile aprire il file '\\\\10.0.1.243/nr_working/emanuele/Progetto_PRISMA/PRISMA_code/.Renviron': Permission denied\n\u001Bg",
        "> ",
        "Sys.getenv(\"RETICULATE_PYTHON\")",
        "[1] \"C:/prova/Rconda/python.exe\"\n",
        "> ",
        "?Sys.getenv",
        "> ",
        "?Sys.setenv",
        "> ",
        "> ",
        "Sys.setenv(RETICULATE_PYTHON = \"C:/prova/Rconda/python.exe\")",
        "> ",
        "usethis::edit_r_environ(scope = \"project\")",
        "\u001BG3;\u001B[31m☐\u001B[39m Modify \u001B]8;;file://\\\\10.0.1.243/nr_working/emanuele/Progetto_PRISMA/PRISMA_code/.Renviron\u0007\u001B[34m.Renviron\u001B[39m\u001B]8;;\u0007.\n\u001Bg\u001BG3;\u001B[31m☐\u001B[39m Restart R for changes to take effect.\n\u001Bg\u001BG2;\u001BH2;Messaggio di avvertimento\u001Bh:\nIn file.info(path) :\n  cannot resolve owner of file '\\\\10.0.1.243/nr_working/emanuele/Progetto_PRISMA/PRISMA_code/.Renviron': Non è stato effettuato alcun mapping tra nomi di account e ID di sicurezza (SID)\n\u001Bg",
        "> ",
        "Sys.setenv(RETICULATE_PYTHON = \"non so\")",
        "> ",
        "usethis::edit_r_environ(scope = \"project\")",
        "\u001BG3;\u001B[31m☐\u001B[39m Modify \u001B]8;;file://\\\\10.0.1.243/nr_working/emanuele/Progetto_PRISMA/PRISMA_code/.Renviron\u0007\u001B[34m.Renviron\u001B[39m\u001B]8;;\u0007.\n\u001Bg\u001BG3;\u001B[31m☐\u001B[39m Restart R for changes to take effect.\n\u001Bg\u001BG2;\u001BH2;Messaggio di avvertimento\u001Bh:\nIn file.info(path) :\n  cannot resolve owner of file '\\\\10.0.1.243/nr_working/emanuele/Progetto_PRISMA/PRISMA_code/.Renviron': Non è stato effettuato alcun mapping tra nomi di account e ID di sicurezza (SID)\n\u001Bg",
        "> ",
        "Sys.setenv(RETICULATE_PYTHON = \"non so\")",
        "> ",
        "Sys.getenv",
        "function (x = NULL, unset = \"\", names = NA) \n{\n    if (is.null(x)) {\n        x <- .Internal(Sys.getenv(character(), \"\"))\n        m <- regexpr(\"=\", x, fixed = TRUE)\n        n <- substring(x, 1L, m - 1L)\n        v <- substring(x, m + 1L)\n        if (isFALSE(names)) \n            v[sort.list(n)]\n        else {\n            v <- structure(v, names = n)\n            structure(class = \"Dlist\", v[sort.list(n)])\n        }\n    }\n    else {\n        v <- .Internal(Sys.getenv(as.character(x), as.character(unset)))\n       ",
        " if (isTRUE(names) || (length(x) > 1L && !isFALSE(names))) \n            structure(v, names = x)\n        else v\n    }\n}\n<bytecode: 0x00000180ecd49630>\n<environment: namespace:base>\n",
        "> ",
        "Sys.getenv(\"RETICULATE_PYTHON\")",
        "[1] \"non so\"\n",
        "> ",
        "Sys.setenv(RETICULATE_PYTHON = \"C:/prova/Rconda/python.exe\")",
        "> ",
        "reticulate::py_discover_config(use_environment = \"C:/prova/Rconda/python.exe\")",
        "python:         C:/prova/Rconda/python.exe\nlibpython:      C:/prova/Rconda/python38.dll\npythonhome:     C:\\prova\\Rconda\nversion:        3.8.20 | packaged by conda-forge | (default, Sep 30 2024, 17:44:03) [MSC v.1929 64 bit (AMD64)]\nArchitecture:   64bit\nnumpy:          C:\\prova\\Rconda\\lib\\site-packages\\numpy\nnumpy_version:  1.24.4\n\nNOTE: Python version was forced by RETICULATE_PYTHON\n",
        "> ",
        "reticulate::use_python(python = \"C:/prova/Rconda/python.exe\")",
        "> ",
        "reticulate::py_config()",
        "python:         C:/prova/Rconda/python.exe\nlibpython:      C:/prova/Rconda/python38.dll\npythonhome:     C:\\prova\\Rconda\nversion:        3.8.20 | packaged by conda-forge | (default, Sep 30 2024, 17:44:03) [MSC v.1929 64 bit (AMD64)]\nArchitecture:   64bit\nnumpy:          C:\\prova\\Rconda\\lib\\site-packages\\numpy\nnumpy_version:  1.24.4\n\nNOTE: Python version was forced by RETICULATE_PYTHON\n\u001BG3;Restarting R session...\u001Bg"
    ]
}